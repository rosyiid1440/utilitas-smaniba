<h1 class="text-3xl font-semibold text-gray-700">Dashboard Analitik</h1>
<p class="mt-2 text-gray-600">Visualisasi data penggunaan jaringan hotspot sekolah.</p>

<div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold text-gray-700">Aktivitas Pengguna (24 Jam Terakhir)</h3>
        <div class="mt-4 h-64">
            <canvas id="onlineUsersChart"></canvas>
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold text-gray-700">Total Penggunaan Data (7 Hari Terakhir)</h3>
        <div class="mt-4 h-64">
            <canvas id="dailyUsageChart"></canvas>
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold text-gray-700">Top 5 Pengguna Data (7 Hari Terakhir)</h3>
        <div class="mt-4 h-64 flex justify-center items-center">
            <canvas id="topUsersChart"></canvas>
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold text-gray-700">Distribusi Pengguna Online per Profil</h3>
        <div class="mt-4 h-64 flex justify-center items-center">
            <canvas id="profileDistributionChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Fungsi pembantu generik
    function renderChart(canvasId, chartConfig) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        new Chart(ctx, chartConfig);
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Grafik #1: Pengguna Online per Jam (Line)
        fetch('/api/reports/online-users-hourly')
            .then(response => response.json())
            .then(chartData => {
                renderChart('onlineUsersChart', {
                    type: 'line',
                    data: {
                        labels: chartData.labels,
                        datasets: [{ label: 'Jumlah Pengguna', data: chartData.data, backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 2, fill: true, tension: 0.3 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            });

        // Grafik #2: Penggunaan Data Harian (Bar)
        fetch('/api/reports/daily-usage')
            .then(response => response.json())
            .then(chartData => {
                renderChart('dailyUsageChart', {
                    type: 'bar',
                    data: {
                        labels: chartData.labels,
                        datasets: [{ label: 'Total Penggunaan (GB)', data: chartData.data, backgroundColor: 'rgba(22, 163, 74, 0.5)', borderColor: 'rgba(22, 163, 74, 1)', borderWidth: 1 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            });

        // [BARU] Grafik #3: Top Pengguna (Pie)
        fetch('/api/reports/top-data-users')
            .then(response => response.json())
            .then(chartData => {
                renderChart('topUsersChart', {
                    type: 'pie',
                    data: {
                        labels: chartData.labels,
                        datasets: [{ label: 'Penggunaan (GB)', data: chartData.data }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            });

        // [BARU] Grafik #4: Distribusi Profil (Doughnut)
        fetch('/api/reports/profile-distribution')
            .then(response => response.json())
            .then(chartData => {
                renderChart('profileDistributionChart', {
                    type: 'doughnut',
                    data: {
                        labels: chartData.labels,
                        datasets: [{ label: 'Jumlah Pengguna', data: chartData.data }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            });
    });
</script>